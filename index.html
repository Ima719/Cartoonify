<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù…Ø­ÙˆÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ ÙƒØ±ØªÙˆÙ† (Ø®ÙÙŠÙ)</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
      background: #f5f5f5;
    }
    canvas {
      border: 1px solid #ccc;
      margin: 10px;
      max-width: 100%;
      background: white;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      background: #2196F3;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
  </style>
</head>
<body>
  <h1>ğŸ¨ Ù…Ø­ÙˆÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ ÙƒØ±ØªÙˆÙ† (Ù†Ø³Ø®Ø© Ø®ÙÙŠÙØ©)</h1>
  <p>Ø§Ø®ØªØ± ØµÙˆØ±Ø© â€” Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ ØªØ£Ø«ÙŠØ± ÙƒØ±ØªÙˆÙ†ÙŠ Ø¨Ø³ÙŠØ· ÙÙˆØ±Ù‹Ø§!</p>
  
  <input type="file" id="imageLoader" accept="image/*" />
  
  <div class="container">
    <div>
      <h3>Ø§Ù„Ø£ØµÙ„ÙŠØ©</h3>
      <canvas id="originalCanvas"></canvas>
    </div>
    <div>
      <h3>Ø§Ù„ÙƒØ±ØªÙˆÙ†ÙŠØ©</h3>
      <canvas id="cartoonCanvas"></canvas>
    </div>
  </div>
  <button onclick="downloadCartoon()">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>

  <script>
    let img = new Image();
    img.onload = function() {
      const maxWidth = 600;
      const scale = Math.min(1, maxWidth / img.width);
      const width = img.width * scale;
      const height = img.height * scale;

      // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
      const orig = document.getElementById('originalCanvas');
      orig.width = width;
      orig.height = height;
      orig.getContext('2d').drawImage(img, 0, 0, width, height);

      // ØªØ·Ø¨ÙŠÙ‚ ØªØ£Ø«ÙŠØ± ÙƒØ±ØªÙˆÙ† Ø¨Ø³ÙŠØ·
      const cartoon = document.getElementById('cartoonCanvas');
      cartoon.width = width;
      cartoon.height = height;
      const ctx = cartoon.getContext('2d');
      ctx.drawImage(img, 0, 0, width, height);

      // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø£Ù„ÙˆØ§Ù† (Color Quantization Ù…Ø¨Ø³Ø·)
      const imageData = ctx.getImageData(0, 0, width, height);
      const data = imageData.data;
      for (let i = 0; i < data.length; i += 4) {
        // ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø¥Ù„Ù‰ Ù‚ÙŠÙ… Ù…Ø­Ø¯Ø¯Ø© (Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ÙƒØ±ØªÙˆÙ†)
        data[i]     = Math.floor(data[i] / 50) * 50;     // Red
        data[i + 1] = Math.floor(data[i + 1] / 50) * 50; // Green
        data[i + 2] = Math.floor(data[i + 2] / 50) * 50; // Blue
      }
      ctx.putImageData(imageData, 0, 0);

      // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯ÙˆØ¯ Ø³ÙˆØ¯Ø§Ø¡ Ø®ÙÙŠÙØ© (Ù…Ø­Ø§ÙƒØ§Ø© Ø®Ø·ÙˆØ· Ø§Ù„ÙƒØ±ØªÙˆÙ†)
      ctx.strokeStyle = 'black';
      ctx.lineWidth = 1;
      ctx.strokeRect(0, 0, width, height);
    };

    document.getElementById('imageLoader').onchange = function(e) {
      if (e.target.files[0]) {
        const reader = new FileReader();
        reader.onload = ev => img.src = ev.target.result;
        reader.readAsDataURL(e.target.files[0]);
      }
    };

    function downloadCartoon() {
      const canvas = document.getElementById('cartoonCanvas');
      if (canvas.width === 0) {
        alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£ÙˆÙ„Ù‹Ø§!");
        return;
      }
      const a = document.createElement('a');
      a.download = 'cartoon-effect.png';
      a.href = canvas.toDataURL();
      a.click();
    }
  </script>
</body>
</html>
